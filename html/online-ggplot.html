<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Online Workshop - ggplot2</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="notes.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Online Workshop - ggplot2</h1>
<p class="subtitle">R for Reproducible Scientific Analysis - plotting</p>
</header>
<p>Import the Socrative quiz bank for this module with <strong>SOC-46399671</strong></p>
<h2 id="before-the-workshop-starts">Before the workshop starts</h2>
<ol type="1">
<li>Turn on Do-Not-Disturb (phone + computer)</li>
<li>Clear desktop, download the data, and save on desktop</li>
<li>Close as many running programs as possible</li>
<li>Open up Socrative and login to the teacher tools</li>
<li>Open up etherpad, and the course website</li>
<li>Make sure Dropbox is running</li>
<li>Screen share the etherpad TODO list: (workshop website, etherpad, introduce yourself, choose breakout room, install packages/test software, pre-workshop survey)</li>
</ol>
<h2 id="workshop-introduction-5-minutes">Workshop introduction (5 minutes)</h2>
<ul>
<li>Etherpad intro
<ul>
<li>Collaborative note taking. Anyone can contribute notes, but instructors will be adding a lot, so that you don’t have to. This way you can focus on listening and coding, rather than notes.</li>
<li>A place to ask questions. We’d prefer this over the Zoom chat, we can keep the chat.</li>
</ul></li>
<li>Code of Conduct
<ul>
<li>We ask that you please be respectful to everyone here.</li>
<li>Teaching this is hard work, and not everyone is on the same knowledge level.</li>
<li>Please do not record this session, there are privacy implications to this</li>
<li>Please pay attention to what you are screen sharing, and any private messages, and practice respect here too.</li>
</ul></li>
<li>Helpers
<ul>
<li>We have a bunch of helpers to help you when we break into small groups</li>
<li>They’re also available to answer questions and troubleshoot</li>
</ul></li>
<li>Socrative
<ul>
<li>We’ll use this to ask questions and do short checkpoint assignments</li>
</ul></li>
<li>Why do this workshop?
<ul>
<li>Time-saving!!! Work smarter, not harder!</li>
<li>Reproducible research, collaboration</li>
</ul></li>
</ul>
<h2 id="intro-to-zoom-20-minutes">Intro to Zoom (20 minutes)</h2>
<ul>
<li>Non-Verbal feedback
<ul>
<li>Even though we’re not in the same room, we want to see your feedback</li>
<li>We will use the Yes and No non-verbal feedback icons in the Participants window to answer questions and as Stop and Go signs.
<ul>
<li>If you’re stuck, use these to let me know if you need me to slow down</li>
<li>I’ll also remind you to use them at times</li>
<li>Go ahead and click on the Participants button at the bottom of your screen</li>
<li>There’s also a Raise Hand icon that you can use to ask a question</li>
</ul></li>
</ul></li>
<li>Muting and Unmuting
<ul>
<li>Please keep yourself muted when you can, so we can hear.</li>
<li>You can temporarily unmute by pressing spacebar.</li>
</ul></li>
<li>Breakout rooms + screen sharing
<ul>
<li>We’ll use this for you to work through problems in small groups</li>
<li>If you get a message to join or leave a breakout room, say yes.</li>
<li>Your helper will help you out while there.</li>
</ul></li>
<li>Setting up your screen
<ul>
<li>If you have a way of using two screens, do that.</li>
<li>Your main screen will be your coding screen, and you can watch me on your other one</li>
<li>If you only have one screen, try to put RStudio and Zoom side-by-side
<ul>
<li>Set Zoom to Fit to Window</li>
</ul></li>
</ul></li>
<li>What happens if Zoom crashes?
<ul>
<li>We will try to return to the same meeting</li>
<li>Watch the Etherpad for updates</li>
</ul></li>
<li>Let’s start
<ul>
<li>Put up a Yes in the participant window if you have Socrative open in a tab</li>
<li>Now, we’re going to break up into groups.</li>
<li>With your helper and partner, work through the list of tasks on Socrative.</li>
</ul></li>
</ul>
<p><strong><em>———- Socrative #1 ———-</em></strong>: Test everything in Zoom</p>
<h2 id="publication-quality-graphics">Publication-quality graphics</h2>
<h3 id="background-r-10-minutes">Background R (10 minutes)</h3>
<ul>
<li>Projects
<ul>
<li>In many cases, people’s data and results look like this:
<ul>
<li><a href="(show%20screenshot)">http://swcarpentry.github.io/r-novice-gapminder/02-project-intro/index.html</a></li>
<li>One thing that’s really helpful for reproducibility and sharing, is to have a self-contained and well-organized project</li>
</ul></li>
<li>Create a new project through RStudio on the desktop named <code>ggplot-workshop</code></li>
<li>Make folders for <code>data</code>, and <code>figures</code> (I also add <code>analyses</code>)</li>
<li>Move your gapminder_data.csv file on your desktop into your <code>data</code> folder.</li>
<li>Show how you’d open this project again.</li>
</ul></li>
<li>Read in data
<ul>
<li>Tab-complete</li>
<li>CTRL+Enter or CMD+Enter</li>
<li><code>gap &lt;- read.csv("data/gapminder_data.csv")</code></li>
</ul></li>
<li>Comments</li>
<li>Getting help
<ul>
<li><code>?read.csv</code></li>
</ul></li>
<li>Examine data
<ul>
<li><code>head(gap)</code></li>
<li><code>str(gap)</code></li>
</ul></li>
<li>Dropbox script to follow along</li>
</ul>
<h3 id="ggplot-introduction-60-minutes">ggplot Introduction (60 minutes)</h3>
<p><strong>Question: How many of you have made a plot in R? How many of you have used ggplot?</strong></p>
<ul>
<li><p>R has a few different ways to plot things.<br />
</p></li>
<li><p>It comes with a basic plotting package, but most people don’t use this anymore, it’s harder to modify</p></li>
<li><p>A better option is ggplot2, which is more flexible, build plots in layers (kinda like photoshop)</p>
<ul>
<li>First we load ggplot2
<ul>
<li><code>library(ggplot2)</code></li>
</ul></li>
</ul></li>
<li><p>Grammar of graphics: Every plot is a dataset, a coordinate system, and a set of layers that are the visual representation</p></li>
<li><p>Then we call ggplot, all the options in here apply to all layers</p>
<ul>
<li><p>mapping = aes() tells ggplot how data variables map to aesthetic properties</p></li>
<li><p>ggplot is smart enough to look for those columns in the data we gave it, no need to subset</p></li>
<li><p>If we stop here we don’t get a graph</p>
<ul>
<li><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp))</code></li>
</ul></li>
<li><p>So finally, we add a points (scatterplot) layer called a geometry</p></li>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) +
    geom_point()</code></pre></li>
</ul></li>
</ul>
<p><strong><em>———- Socrative #2 ———-</em></strong>: Modify a ggplot graph</p>
<ul>
<li><p>Solution:</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = year, y = lifeExp, 
    color = continent)) +
    geom_point()</code></pre></li>
</ul></li>
<li><p>Using a scatterplot probably isn’t a good way to show change over time.</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = year, y = lifeExp, 
    group = country, color = continent)) +
    geom_line()</code></pre></li>
</ul></li>
<li><p>We’re using a line geometry instead of a points geometry now</p></li>
<li><p>the <strong>by</strong> mapping = aesthetic draws a line for each country, and then we color each continent differently.</p></li>
<li><p><strong>Question: What if we wanted the points on the graph too?</strong></p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = year, y = lifeExp, 
    group = country, color = continent)) +
    geom_line() + 
    geom_point()</code></pre></li>
</ul></li>
<li><p>Layers get drawn on top of each other</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = year, y = lifeExp, 
    group = country)) +
    geom_line(mapping = aes(color = continent)) + 
    geom_point()</code></pre></li>
</ul></li>
<li><p>Here we’ve switched the color mapping = aesthetic from global to just the lines</p></li>
<li><p>If we want to set everything on a geometry to the same color, we set it outside the aesthetic function</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = year, y = lifeExp, 
    group = country)) +
    geom_line(mapping = aes(color = continent)) + 
    geom_point(color = &quot;blue&quot;)</code></pre></li>
</ul></li>
<li><p>Let’s go back to our first example, but color the points by continent</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp, 
    color = continent)) +
    geom_point()</code></pre></li>
</ul></li>
<li><p>Hard to see relationship with all those outliers, so let’s use a log scale &amp; transparency</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) +
    geom_point(alpha = 0.5) + 
    scale_x_log10()</code></pre></li>
</ul></li>
<li><p>Notice the data has been transformed before graphing, x axis reflects this (1,000, 10,000, 100,000)</p></li>
<li><p>Here we also use transparency so that overlapping points are easier to see. This works with any geometry.</p></li>
<li><p>We could also set this to use a data column inside mapping = aes()</p></li>
<li><p>We can fit a simple linear regression line (linear model) using a geom_smooth geometry layer</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) +
    geom_point() + 
    scale_x_log10() + 
    geom_smooth(method = &quot;lm&quot;)</code></pre></li>
</ul></li>
<li><p>It even gives us a confidence interval! We can make the line thicker using size</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) +
    geom_point() + 
    scale_x_log10() + 
    geom_smooth(method = &quot;lm&quot;, size = 1.5)</code></pre></li>
</ul></li>
</ul>
<p><strong><em>———- Socrative #3 ———-</em></strong>: Color by continent &amp; add separate trends</p>
<ul>
<li>Solution
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) +
    geom_point(aes(color = continent), size = 0.5) +
    scale_x_log10() +
    geom_smooth(aes(group = continent), method = &quot;lm&quot;)</code></pre></li>
</ul></li>
<li>Many peope are colorblind. In addition to color, it’s a good idea to also use shape
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp, 
    color = continent)) +
    geom_point(size = 2, mapping = aes(shape = continent)) + 
    scale_x_log10() + 
    geom_smooth(method = &quot;lm&quot;)</code></pre></li>
</ul></li>
</ul>
<h3 id="publication-15-minutes">Publication (15 minutes)</h3>
<ul>
<li>Let’s clean it up for publication. We’ll add nicer axis labels, a title, and change the y-axis and theme
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp, 
    color = continent)) +
    geom_point(mapping = aes(shape = continent), size = 2, alpha = 0.5) + 
    scale_x_log10() + 
    geom_smooth(method = &quot;lm&quot;) + 
    scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + 
    theme_minimal() + 
    labs(title = &quot;Effects of per-capita GDP on Life Expectancy&quot;, # graph title
        x = &quot;GDP per Capita ($)&quot;, # x-axis title
        y = &quot;Life Expectancy (yrs)&quot;, # y-axis title
        color = &quot;Continents&quot;, # color legend title
        shape = &quot;Continents&quot;) # shape legend title</code></pre></li>
</ul></li>
</ul>
<p><strong><em>———- Socrative #4 ———-</em></strong>: Optional build new plot &amp; make pub quality</p>
<ul>
<li>Solution:
<ul>
<li><p><span></span></p>
<pre><code>library(scales)
ggplot(data = gap, mapping = aes(x = pop, y = gdpPercap, 
     color = continent)) + 
     geom_point() +
     scale_x_log10(labels = comma) + 
     scale_y_log10(labels = comma) +
     theme_minimal() +
     labs(x = &quot;GDP per Capita ($)&quot;, 
          y = &quot;Life Expectancy (yrs)&quot;, 
          color = &quot;Continents&quot;)</code></pre></li>
</ul></li>
</ul>
<h3 id="saving-10-minutes">Saving (10 minutes)</h3>
<ul>
<li>Now we have this graph, but we want to save it!
<ul>
<li>Rstudio has an export button: pdf, image, or to clipboard, lets you change size
<ul>
<li>The problem with this is that it’s not reproducible. You fiddle with the size, but then months from now you need to change something</li>
</ul></li>
<li>Better to do it programmatically
<ul>
<li><code>ggsave(file = "figures/life_expectancy.png")</code></li>
<li><code>ggsave(file = "figures/life_expectancy.pdf")</code></li>
</ul></li>
</ul></li>
</ul>
<p><strong><em>———- Socrative #5 ———-</em></strong>: Optional ggsave &amp; ggplot variables</p>
<ul>
<li>Solution: ggsave will overwrite the graph
<ul>
<li><p><span></span></p>
<pre><code>lifeExp_plot &lt;- ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) + 
    geom_point()

lifeExp_plot

ggsave(plot = lifeExp_plot, file = &quot;figures/life_expectancy_gdpPerCapita.pdf&quot;)</code></pre></li>
</ul></li>
</ul>
<h3 id="facets-15-minutes">Facets (15 minutes)</h3>
<ul>
<li><p>Often, we want multi-paneled graphs, e.g., to show how trends differ across continents</p></li>
<li><p>For this, we use facets</p></li>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) + 
     facet_wrap(~ continent) + 
     geom_point(alpha = 0.5) + 
     scale_x_log10() +
     geom_smooth(method = &quot;lm&quot;)</code></pre></li>
<li><p>This draws a panel for each unique value in column we give facet_wrap()</p></li>
<li><p>We can also change some things in the facet: independent scales and # cols</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) + 
     facet_wrap(~ continent, scales = &quot;free&quot;, ncol = 2) + 
     geom_point(alpha = 0.5) + 
     scale_x_log10() +
     geom_smooth(method = &quot;lm&quot;)</code></pre></li>
</ul></li>
</ul>
<p><strong><em>———- Socrative #6 ———-</em></strong>: Optional Facets, facet by year, color by continent</p>
<ul>
<li>Solution
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp, 
    color = continent)) + 
    facet_wrap(~ year) + 
    geom_point(alpha = 0.5) + 
    scale_x_log10() +
    geom_smooth(method = &quot;lm&quot;)</code></pre></li>
</ul></li>
</ul>
<h3 id="cowplot-10-minutes">Cowplot (10 minutes)</h3>
<ul>
<li>Cover cowplot:
<ul>
<li><p>Nicer pub quality theme than default ggplot theme or theme minimal</p></li>
<li><p>Also provides a way to merge two plots into one, eg A &amp; B figures, and annotations</p></li>
<li><p><span></span></p>
<pre><code>plotA &lt;- ggplot(data = gap, mapping = aes(x = gdpPercap, y = lifeExp)) + 
     geom_point(alpha = 0.5) + 
     scale_x_log10() +
     geom_smooth(method = &quot;lm&quot;) +
     theme_cowplot()
plotA
plotB &lt;- ggplot(data = gap, mapping = aes(x = continent, y = lifeExp)) + 
     geom_boxplot() + 
     theme_cowplot()

plotB

plot_grid(plotA, plotB, labels = c(&quot;A&quot;, &quot;B&quot;))

ggsave(file = &quot;figures/test.pdf&quot;, width = 10, height = 5, 
    units = &quot;in&quot;, dpi = 300)</code></pre></li>
<li><p>Google “cowplot package”, show how to get to vignette</p>
<ul>
<li>Or: <code>browseVignettes("cowplot")</code></li>
</ul></li>
<li><p>I use ggdraw() a lot as a more flexible plot_grid()</p>
<ul>
<li><p><span></span></p>
<pre><code>ggdraw() +
    draw_plot(plotA, x = 0, y = 0, width = 0.3, height = 1) + 
    draw_plot(plotB, x = 0.3, y = 0, width = 0.7, height = 1)</code></pre></li>
</ul></li>
</ul></li>
</ul>
<h3 id="interactive-graphs-5-minutes">Interactive graphs (5 minutes)</h3>
<ul>
<li>many options, but we’ll show you ggplotly
<ul>
<li><p><span></span></p>
<pre><code>library(plotly)
yearLifeExp &lt;- ggplot(data = gap, mapping = aes(x = year, y = lifeExp, 
    group = country)) +
    facet_wrap(~ continent) +
    geom_line() +
    scale_x_log10()

ggplotly(yearLifeExp)</code></pre></li>
</ul></li>
</ul>
<h3 id="themes-10-minutes">Themes (10 minutes)</h3>
<ul>
<li>Rather than using theme_minimal() or theme_cowplot() by itself, we can customize that, too</li>
<li><a href="ggplot2.tidyverse.org./reference/ggtheme.html">http://ggplot2.tidyverse.org./reference/ggtheme.html</a></li>
<li><a href="ggplot2.tidyverse.org./reference/theme.html">http://ggplot2.tidyverse.org./reference/theme.html</a></li>
<li>Adjust text size
<ul>
<li><p><span></span></p>
<pre><code>theme(
    # Text size for axis ticks
    axis.text.y = element_text(size = 14),
    axis.text.x = element_text(size = 14),

    # Text size for axis labels
    # Also move them away from the axes a bit for more space
    axis.title.x = element_text(size = 18, face = &quot;bold&quot;, vjust = -1),
    axis.title.y = element_text(size = 18, face = &quot;bold&quot;, vjust = 1.5),

    # Plot title size, move away from plot
    plot.title = element_text(size = 20, face = &quot;bold&quot;, vjust = 5)
    )</code></pre></li>
</ul></li>
<li>Adjust legend position
<ul>
<li><p><span></span></p>
<pre><code>theme(
    # Text size
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = &quot;bold&quot;),

    # Position
    legend.position = c(x = 0.8, y = 0.2)
    )</code></pre></li>
</ul></li>
</ul>
<h3 id="ggplot2-challenge-1">GGplot2 Challenge #1:</h3>
<ul>
<li><p>Create a boxplot showing the spread of life expectancy for each continent</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = continent, y = lifeExp)) + 
   geom_boxplot() + 
   geom_jitter(width = 0.2, alpha = 0.5, color = &quot;tomato&quot;)

ggplot(data = gap, mapping = aes(x = continent, y = lifeExp)) + 
    geom_boxplot() + 
    geom_jitter(width = 0.2, alpha = 0.5, size = 2, 
        mapping = aes(color = factor(year)))</code></pre></li>
</ul></li>
</ul>
<h3 id="ggplot2-challenge-2">GGplot2 Challenge #2:</h3>
<ul>
<li><p>Create a grouped barplot showing life expectancy by year for each continent</p>
<ul>
<li><p><span></span></p>
<pre><code>ggplot(data = gap, mapping = aes(x = continent)) + 
    geom_bar()

ggplot(data = gap, mapping = aes(x = continent, y = lifeExp, fill = factor(year))) + 
    geom_bar(stat = &quot;summary&quot;, fun.y = &quot;mean&quot;, position = &quot;dodge&quot;)</code></pre></li>
</ul></li>
</ul>
<h3 id="resources">Resources</h3>
<ul>
<li>R Graph catalog: <a href="http://shiny.stat.ubc.ca/r-graph-catalog/">http://shiny.stat.ubc.ca/r-graph-catalog/</a></li>
<li>GGPlot2 online help: <a href="ggplot2.tidyverse.org">http://ggplot2.tidyverse.org</a></li>
<li>R Graph Cookbook: <a href="http://www.cookbook-r.com/Graphs/">http://www.cookbook-r.com/Graphs/</a></li>
<li>ggplot2 essentials: <a href="http://www.sthda.com/english/wiki/ggplot2-essentials">http://www.sthda.com/english/wiki/ggplot2-essentials</a></li>
<li>Rstudio cheatsheets: <a href="https://www.rstudio.com/resources/cheatsheets/">https://www.rstudio.com/resources/cheatsheets/</a></li>
<li>Cowplot: <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html</a></li>
</ul>
</body>
</html>
